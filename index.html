<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>If I Forget You First — Full Version</title>

<link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,400;0,700;1,400&family=Great+Vibes&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

<style>
:root {
  --bg-color: #050508;
  --accent: #d4b3ff;
  --accent-muted: rgba(212, 179, 255, 0.4);
  --text: #f0f0f5;
  --muted: #9499b0;
  --panel-bg: rgba(10, 8, 15, 0.88);
  --lace-border: rgba(212, 179, 255, 0.3);
}

* { box-sizing: border-box; }
body, html { 
    height: 100%; margin: 0; padding: 0; 
    background: var(--bg-color); 
    font-family: 'Inter', sans-serif; 
    overflow: hidden; color: var(--text);
}

/* --- Visual Effects --- */
#background {
  position: fixed; inset: 0;
  background: url("https://images.unsplash.com/photo-1518107616985-bd48230d3b20?q=80&w=2070&auto=format&fit=crop") center/cover no-repeat;
  filter: brightness(0.45) saturate(0.7);
  transition: filter 2s ease;
  z-index: 1;
}

#vignette {
    position: fixed; inset: 0; pointer-events: none;
    background: radial-gradient(circle at center, transparent 20%, rgba(0,0,0,0.8) 100%);
    z-index: 2;
}

/* --- Stage & Characters --- */
#stage {
  position: relative; width: 100%; height: 100vh;
  z-index: 3; display: flex; justify-content: center; align-items: flex-end;
}

.sprite {
  position: absolute; bottom: -2%;
  height: 92vh; transition: all 1s ease-out;
  filter: drop-shadow(0 0 40px rgba(0,0,0,0.9));
  opacity: 0; pointer-events: none;
}

#airi { left: 12%; transform: translateX(-30px); }
#shino { right: 12%; transform: translateX(30px); }
.sprite.active { opacity: 1; transform: translateX(0); }
.sprite.fading { opacity: 0.15; filter: blur(10px) grayscale(1); }

/* --- Lacy Textbox Design --- */
#ui-wrapper {
  position: absolute; bottom: 0; left: 0; width: 100%;
  padding: 30px; z-index: 10;
  display: flex; flex-direction: column; align-items: center;
}

#textbox {
  width: 100%; max-width: 1000px;
  min-height: 180px; padding: 40px 50px;
  background: var(--panel-bg);
  backdrop-filter: blur(15px);
  border: 2px solid var(--accent);
  border-radius: 12px;
  position: relative;
  box-shadow: 0 -20px 60px rgba(0,0,0,0.9);
  cursor: pointer;
}

/* Lacy Flourish Overlay */
.lace-edge {
    position: absolute; inset: -5px;
    border: 15px solid transparent;
    border-image: url("data:image/svg+xml,%3Csvg width='80' height='80' viewBox='0 0 80 80' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M40 0C50 20 70 20 80 0V80C70 60 50 60 40 80C30 60 10 60 0 80V0C10 20 30 20 40 0Z' fill='none' stroke='%23d4b3ff' stroke-width='1.5' opacity='0.4'/%3E%3C/svg%3E") 30 stretch;
    pointer-events: none;
}

#nameplate {
  position: absolute; top: -28px; left: 50px;
  font-family: 'Great Vibes', cursive; font-size: 2.4rem;
  color: var(--accent); padding: 0 25px;
  background: var(--bg-color); border-radius: 40px;
  border: 1px solid var(--accent); z-index: 11;
  text-shadow: 0 0 10px var(--accent-muted);
}

#line {
  font-family: 'Merriweather', serif; font-size: 1.25rem;
  line-height: 1.9; margin: 0; text-shadow: 1px 1px 2px black;
}

/* --- HUD Controls --- */
#controls {
    position: absolute; top: -45px; right: 20px;
    display: flex; gap: 12px;
}

.small-btn {
    background: rgba(0,0,0,0.7); border: 1px solid var(--lace-border);
    color: var(--muted); padding: 6px 18px; border-radius: 20px;
    font-size: 11px; cursor: pointer; text-transform: uppercase;
    transition: 0.3s; letter-spacing: 1px;
}

.small-btn:hover, .small-btn.active { color: var(--accent); border-color: var(--accent); background: #1a1625; }

/* --- Overlays (Choices, Log, Ending) --- */
.full-overlay {
  position: fixed; inset: 0; background: rgba(5, 5, 8, 0.95);
  display: none; flex-direction: column; justify-content: center;
  align-items: center; gap: 20px; z-index: 100; padding: 40px;
}

.choice-btn {
  width: 90%; max-width: 500px; padding: 20px;
  background: rgba(212, 179, 255, 0.05); border: 1px solid var(--accent);
  color: var(--text); font-size: 1.1rem; cursor: pointer;
  transition: 0.3s; border-radius: 8px; text-align: center;
}
.choice-btn:hover { background: var(--accent); color: #000; transform: translateY(-3px); }

#log-container {
    width: 100%; max-width: 800px; height: 70vh;
    overflow-y: auto; background: rgba(255,255,255,0.03);
    padding: 30px; border-radius: 12px; border: 1px solid var(--lace-border);
}

.log-entry { margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 10px; }
.log-name { color: var(--accent); font-weight: bold; font-family: 'Merriweather'; font-size: 0.9rem; }

/* --- Responsive Layout --- */
@media (min-width: 1024px) {
    #ui-wrapper { padding-bottom: 50px; }
    #line { font-size: 1.35rem; }
}
@media (max-width: 768px) {
    #textbox { padding: 25px 30px; min-height: 220px; }
    #nameplate { font-size: 1.8rem; left: 20px; }
    .sprite { height: 70vh; }
}
</style>
</head>
<body>

<div id="background"></div>
<div id="vignette"></div>

<div id="stage">
  <img id="airi" class="sprite" src="airi.png" alt="">
  <img id="shino" class="sprite" src="shino.png" alt="">
</div>

<div id="choices-overlay" class="full-overlay"></div>

<div id="log-overlay" class="full-overlay">
    <h2 style="font-family:Great Vibes; font-size:3rem; color:var(--accent);">Memory Log</h2>
    <div id="log-container"></div>
    <button class="small-btn" onclick="toggleLog()">Close Log</button>
</div>

<div id="ending-overlay" class="full-overlay">
    <div id="lace-decoration" class="lace-edge" style="opacity: 0.2; inset: 20px;"></div>
    <h1 id="end-title" style="font-family:Great Vibes; font-size:5rem; color:var(--accent); margin:0;"></h1>
    <p id="end-desc" style="max-width:600px; text-align:center; line-height:1.8; color:var(--muted);"></p>
    <button class="choice-btn" onclick="location.reload()" style="margin-top:30px;">Return to Title</button>
</div>

<div id="ui-wrapper" style="display:none;">
    <div id="textbox">
        <div class="lace-edge"></div>
        <div id="nameplate">Airi</div>
        <div id="controls">
            <button class="small-btn" onclick="toggleSkip()" id="skipBtn">Skip: Off</button>
            <button class="small-btn" onclick="toggleLog()">Log</button>
        </div>
        <p id="line"></p>
        <div style="position:absolute; bottom:15px; right:30px; font-size:12px; color:var(--accent); opacity:0.6;">▼</div>
    </div>
</div>

<div id="startScreen" style="position:fixed; inset:0; z-index:1000; display:flex; align-items:center; justify-content:center; background:#050508;">
    <div style="text-align:center;">
        <h1 style="font-family: 'Great Vibes', cursive; font-size:6rem; color:var(--accent); margin-bottom:0;">If I Forget You First</h1>
        <p style="letter-spacing:6px; color:var(--muted); margin-bottom:50px; font-size:0.8rem;">A TALE OF WINTER AND WEIGHTLESSNESS</p>
        <button onclick="startGame()" class="choice-btn">BEGIN STORY</button>
    </div>
</div>

<script>
/* -------------------------
   Comprehensive Game Data
   ------------------------- */
const scenes = {
  start: { speaker: "airi", name: "Airi", text: "The station always felt like a waiting room for the afterlife. Cold, sterile, and filled with people who were technically there, but mentally elsewhere.", next: "s1" },
  s1: { speaker: "airi", name: "Airi", text: "I noticed her on a Tuesday. She was wearing a coat that looked two sizes too big, staring at the tracks like she was reading a poem written in the steel.", next: "s2" },
  s2: { speaker: "airi", name: "Airi", text: "I found my feet moving. The snow was beginning to stick to the platform. It felt like the world was quieting down just to hear me fail at a greeting.", choices: [
      { text: "“The trains are late today.”", next: "path_talk", closeness: 1 },
      { text: "Just sit beside her in silence.", next: "path_silent", closeness: 0 }
  ]},
  path_talk: { speaker: "shino", name: "Shino", text: "She finally turned to me. Her eyes were a strange, pale shade. 'I'm Shino. I think I'm supposed to be waiting for someone, but I can't remember their face.'", next: "act2" },
  path_silent: { speaker: "shino", name: "Shino", text: "Without looking at me, she reached out and touched my sleeve. 'You have a very warm presence,' she said softly. 'Thank you for not asking questions.'", next: "act2" },
  act2: { speaker: "airi", name: "Airi", text: "Weeks passed. Every evening, the same bench. But the more I learned about her, the more I felt her slipping away...", next: "final_choice" },
  final_choice: { speaker: "shino", name: "Shino", text: "“Airi... it's time. The train is coming. But there’s only one seat. Do you hold onto me, or do you let me go into the white?”", choices: [
      { text: "Hold her tightly (Cling)", next: "end_1" },
      { text: "Let go and wave (Release)", next: "end_2" }
  ]},
  end_1: { 
      speaker: "airi", name: "Airi", 
      text: "I grabbed her hand. I wouldn't let go. But as the train pulled in, my hand closed on nothing but cold air. She was gone. I have her name, but I can no longer remember why it makes me cry.", 
      ending: true, 
      title: "Eternal Frost", 
      desc: "You chose to hold onto a ghost. Now you carry a name with no face, and a grief with no origin."
  },
  end_2: { 
      speaker: "airi", name: "Airi", 
      text: "I let go. She stepped onto the train and smiled. I forgot her name by the time the tail-lights vanished, but my heart felt light, as if a beautiful song had finally finished playing.", 
      ending: true, 
      title: "Winter's Release", 
      desc: "By letting her go, you saved both of yourselves. The memory is gone, but the peace remains."
  }
};

let state = {
  current: "start",
  closeness: 0,
  isTyping: false,
  isSkipping: false,
  history: []
};

/* -------------------------
   Engine Logic
   ------------------------- */
function startGame() {
    document.getElementById("startScreen").style.display = "none";
    document.getElementById("ui-wrapper").style.display = "flex";
    renderScene();
}

function typeWriter(text) {
    state.isTyping = true;
    let i = 0;
    const lineEl = document.getElementById("line");
    lineEl.innerHTML = "";
    
    if (state.isSkipping) {
        lineEl.innerHTML = text;
        state.isTyping = false;
        return;
    }

    function type() {
        if (i < text.length && state.isTyping) {
            lineEl.innerHTML += text.charAt(i);
            i++;
            setTimeout(type, 25);
        } else {
            lineEl.innerHTML = text;
            state.isTyping = false;
        }
    }
    type();
}

function renderScene() {
    const scene = scenes[state.current];
    if (!scene) return;

    // Log the dialogue
    state.history.push({ name: scene.name, text: scene.text });

    // Handle Sprites
    document.getElementById("airi").classList.toggle("active", scene.speaker === "airi");
    document.getElementById("shino").classList.toggle("active", scene.speaker === "shino");
    if (state.closeness >= 3) document.getElementById("shino").classList.add("fading");

    // UI Updates
    document.getElementById("nameplate").textContent = scene.name;
    typeWriter(scene.text);

    // Clear and Hide Overlays
    const choiceOverlay = document.getElementById("choices-overlay");
    choiceOverlay.style.display = "none";
    choiceOverlay.innerHTML = "";

    // If it's an ending, prepare the ending card
    if (scene.ending) {
        setTimeout(() => showEnding(scene), 3000);
    }
}

function showEnding(scene) {
    document.getElementById("end-title").textContent = scene.title;
    document.getElementById("end-desc").textContent = scene.desc;
    document.getElementById("ending-overlay").style.display = "flex";
}

function toggleSkip() {
    state.isSkipping = !state.isSkipping;
    const btn = document.getElementById("skipBtn");
    btn.textContent = state.isSkipping ? "Skip: On" : "Skip: Off";
    btn.classList.toggle("active");
}

function toggleLog() {
    const logOverlay = document.getElementById("log-overlay");
    const logContainer = document.getElementById("log-container");
    
    if (logOverlay.style.display === "flex") {
        logOverlay.style.display = "none";
    } else {
        logContainer.innerHTML = state.history.map(h => `
            <div class="log-entry">
                <div class="log-name">${h.name}</div>
                <div class="log-text">${h.text}</div>
            </div>
        `).join("");
        logOverlay.style.display = "flex";
    }
}

document.getElementById("textbox").onclick = () => {
    if (state.isTyping) {
        state.isTyping = false; // Fast-forward text
        return;
    }
    
    const scene = scenes[state.current];
    if (scene.choices) {
        document.getElementById("choices-overlay").style.display = "flex";
        scene.choices.forEach(ch => {
            const b = document.createElement("button");
            b.className = "choice-btn";
            b.textContent = ch.text;
            b.onclick = (e) => {
                e.stopPropagation();
                state.closeness += (ch.closeness || 0);
                state.current = ch.next;
                renderScene();
            };
            document.getElementById("choices-overlay").appendChild(b);
        });
    } else if (scene.next) {
        state.current = scene.next;
        renderScene();
    }
};
</script>
</body>
</html>
